<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptMaker - Gerador de Prompts para IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/estilos.css">
</head>
<body>
    <div class="container py-4">
        <!-- Header com informa√ß√µes do usu√°rio -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-center">PromptMaker</h1>
            <div class="d-flex align-items-center gap-3">
                <span class="text-muted">Ol√°, {{ user_name }}!</span>
                <a href="{{ url_for('config') }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-gear"></i> Configura√ß√£o
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-box-arrow-right"></i> Sair
                </a>
            </div>
        </div>
        
        <!-- Resto do conte√∫do existente -->
        <h1 class="mb-4 text-center">Gerador de Prompts para Resumos M√©dicos</h1>
        
        <!-- Se√ß√£o de Configura√ß√£o do Prompt -->
        <div class="card p-4 shadow-sm">
            <h5 class="mb-3">Selecione o tipo de resumo m√©dico:</h5>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-4">
                <div class="col">
                    <div class="card tipo-card selected card-tooltip" data-tipo="artigo_cientifico" data-descricao="Este prompt √© ideal para estudos de pesquisa, como ensaios cl√≠nicos, estudos de coorte ou caso-controle. Ele for√ßa a IA a seguir a estrutura padr√£o de um artigo cient√≠fico.">
                        <div class="tooltip-text">Este prompt √© ideal para estudos de pesquisa, como ensaios cl√≠nicos, estudos de coorte ou caso-controle. Ele for√ßa a IA a seguir a estrutura padr√£o de um artigo cient√≠fico.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üìä</div>
                            <h5 class="card-title">Resumo Estruturado de Artigo Cient√≠fico</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="relato_caso">
                        <div class="tooltip-text">Este prompt √© focado em extrair a narrativa cl√≠nica de um relato de caso, ideal para m√©dicos, residentes e estudantes de medicina.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üë®‚Äç‚öïÔ∏è</div>
                            <h5 class="card-title">Resumo de Relato de Caso Cl√≠nico</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="pico">
                        <div class="tooltip-text">Este formato √© perfeito para quando um cl√≠nico precisa de uma resposta r√°pida sobre uma interven√ß√£o, baseada em evid√™ncias. Formato PICO (Paciente/Problema, Interven√ß√£o, Compara√ß√£o, Outcome/Desfecho).</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üéØ</div>
                            <h5 class="card-title">Resumo "Direto ao Ponto" (PICO)</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="tecnica_cirurgica">
                        <div class="tooltip-text">Essencial para cirurgi√µes se preparando para um procedimento, especialmente um que n√£o realizam com frequ√™ncia. O foco √© na sequ√™ncia de a√ß√µes e nos pontos cr√≠ticos.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üî™</div>
                            <h5 class="card-title">Resumo de T√©cnica Cir√∫rgica</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="guideline">
                        <div class="tooltip-text">Diretrizes de sociedades m√©dicas podem ser longas e densas. Este resumo extrai apenas as recomenda√ß√µes, classificadas por for√ßa de evid√™ncia.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üìù</div>
                            <h5 class="card-title">Resumo de Guideline Cl√≠nico</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="journal_club">
                        <div class="tooltip-text">Este formato √© desenhado para fomentar a discuss√£o e a an√°lise cr√≠tica de um artigo, indo al√©m do simples resumo dos fatos.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üë•</div>
                            <h5 class="card-title">Resumo para "Journal Club"</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="estado_arte">
                        <div class="tooltip-text">Artigos de revis√£o (sejam narrativos ou sistem√°ticos) s√£o a principal fonte de atualiza√ß√£o para cl√≠nicos. Este resumo organiza o conhecimento consolidado, as controv√©rsias e o que est√° por vir.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üîç</div>
                            <h5 class="card-title">Resumo de "Estado da Arte"</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="impacto_clinico">
                        <div class="tooltip-text">Quando um estudo "practice-changing" √© publicado, os m√©dicos n√£o querem saber apenas o p-valor. Eles querem saber: "O qu√£o grande √© o benef√≠cio? Para quem? E a que custo (efeitos adversos)?" Este resumo foca nisso.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üíâ</div>
                            <h5 class="card-title">Resumo de Impacto Cl√≠nico Pr√°tico</h5>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card tipo-card card-tooltip" data-tipo="translacional">
                        <div class="tooltip-text">Cl√≠nicos geralmente n√£o t√™m tempo para ler artigos de ci√™ncia b√°sica. Este resumo faz a ponte, extraindo o potencial cl√≠nico futuro de uma pesquisa feita em laborat√≥rio ou em modelos animais.</div>
                        <div class="card-body text-center">
                            <div class="card-icon">üî¨</div>
                            <h5 class="card-title">Resumo "Da Bancada √† Beira do Leito"</h5>
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="btnGerar" class="btn btn-primary w-100 mb-3">Gerar Prompt</button>
            <div class="mt-3">
                <label class="form-label">Prompt Gerado:</label>
                <textarea id="outputPrompt" class="form-control" rows="6" readonly></textarea>
            </div>
            <div class="mt-3 d-flex flex-wrap gap-2" id="botoesAcoes" style="display:none;">
                <button id="btnCopiar" class="btn btn-copiar">Copiar Prompt</button>
                <button class="btn btn-gemini" onclick="abrirIA('gemini')">Abrir Gemini</button>
                <button class="btn btn-chatgpt" onclick="abrirIA('chatgpt')">Abrir ChatGPT</button>
                <button class="btn btn-deepseek" onclick="abrirIA('deepseek')">Abrir DeepSeek</button>
                <button class="btn btn-claude" onclick="abrirIA('claude')">Abrir Claude</button>
                <button class="btn btn-perplexity" onclick="abrirIA('perplexity')">Abrir Perplexity</button>
                <button class="btn btn-manus" onclick="abrirIA('manus')">Abrir Manus</button>
            </div>
        </div>
    </div>
    
    <script>
        const urlsIA = {
            'gemini': 'https://gemini.google.com/',
            'chatgpt': 'https://chat.openai.com/',
            'deepseek': 'https://chat.deepseek.com/',
            'claude': 'https://claude.ai/',
            'perplexity': 'https://www.perplexity.ai/',
            'manus': 'https://www.manus.im/'
        };
        
        let tipoSelecionado = 'artigo_cientifico';
        let tooltipTimeout;
        
        // Detectar se √© dispositivo touch
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar evento de clique aos cards
            document.querySelectorAll('.tipo-card').forEach(card => {
                // Eventos de clique/touch
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Remover sele√ß√£o anterior
                    document.querySelectorAll('.tipo-card').forEach(c => {
                        c.classList.remove('selected');
                        c.classList.remove('show-tooltip');
                    });
                    // Adicionar sele√ß√£o ao card clicado
                    this.classList.add('selected');
                    // Atualizar tipo selecionado
                    tipoSelecionado = this.getAttribute('data-tipo');
                });
                
                // Eventos para tooltip em dispositivos touch
                if (isTouchDevice) {
                    card.addEventListener('touchstart', function(e) {
                        // Limpar timeout anterior
                        clearTimeout(tooltipTimeout);
                        
                        // Remover tooltips de outros cards
                        document.querySelectorAll('.tipo-card').forEach(c => {
                            if (c !== this) c.classList.remove('show-tooltip');
                        });
                        
                        // Mostrar tooltip do card atual
                        this.classList.add('show-tooltip');
                        
                        // Esconder tooltip ap√≥s 3 segundos
                        tooltipTimeout = setTimeout(() => {
                            this.classList.remove('show-tooltip');
                        }, 3000);
                    });
                }
                
                // Inicializar tooltips a partir do atributo data-descricao
                const descricao = card.getAttribute('data-descricao');
                if (descricao) {
                    const tooltipElement = card.querySelector('.tooltip-text');
                    if (tooltipElement) {
                        tooltipElement.textContent = descricao;
                    }
                }
            });
            
            // Esconder tooltip ao tocar fora (apenas para dispositivos touch)
            if (isTouchDevice) {
                document.addEventListener('touchstart', function(e) {
                    if (!e.target.closest('.tipo-card')) {
                        document.querySelectorAll('.tipo-card').forEach(c => {
                            c.classList.remove('show-tooltip');
                        });
                    }
                });
            }
        });

        // Fun√ß√£o para gerar prompt
        document.getElementById('btnGerar').onclick = async function() {
            // Adicionar feedback visual
            this.disabled = true;
            this.textContent = 'Gerando...';
            
            try {
                const categoria = 'medicina';
                const tipo = tipoSelecionado;
                
                const resp = await fetch('/gerar_prompt', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({categoria, tipo, texto: ''})
                });
                const json = await resp.json();
                document.getElementById('outputPrompt').value = json.prompt;
                document.getElementById('botoesAcoes').style.display = 'flex';
            } catch (error) {
                alert('Erro ao gerar prompt. Tente novamente.');
            } finally {
                this.disabled = false;
                this.textContent = 'Gerar Prompt';
            }
        };

        // Fun√ß√£o para copiar prompt
        document.getElementById('btnCopiar').onclick = async function() {
            const textarea = document.getElementById('outputPrompt');
            
            try {
                // Usar a API moderna de clipboard se dispon√≠vel
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(textarea.value);
                    this.textContent = 'Copiado!';
                } else {
                    // Fallback para dispositivos mais antigos
                    textarea.select();
                    textarea.setSelectionRange(0, 99999); // Para mobile
                    
                    const successful = document.execCommand('copy');
                    if (successful) {
                        this.textContent = 'Copiado!';
                    } else {
                        // Se falhar, mostrar o texto selecionado para c√≥pia manual
                        alert('Selecione e copie o texto manualmente (Ctrl+C ou Cmd+C)');
                        return;
                    }
                }
                
                setTimeout(() => {
                    this.textContent = 'Copiar Prompt';
                }, 2000);
            } catch (err) {
                // Em caso de erro, selecionar o texto para c√≥pia manual
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                alert('Selecione e copie o texto manualmente (Ctrl+C ou Cmd+C)');
            }
        };

        // Fun√ß√£o para abrir plataformas de IA
        function abrirIA(plataforma) {
            const url = urlsIA[plataforma];
            if (url) {
                // Adicionar pequeno delay para melhor feedback em mobile
                const button = event.target;
                button.style.transform = 'scale(0.95)';
                
                setTimeout(() => {
                    button.style.transform = '';
                    window.open(url, '_blank');
                }, 100);
            }
        }
        
        // Prevenir zoom em inputs em iOS
        document.addEventListener('touchstart', function(e) {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') {
                e.target.style.fontSize = '16px';
            }
        });
        
        // Fun√ß√£o para copiar URL
        async function copiarIP(elemento) {
            const texto = elemento.textContent;
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(texto);
                } else {
                    // Fallback para dispositivos mais antigos
                    const textArea = document.createElement('textarea');
                    textArea.value = texto;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
                
                // Feedback visual
                const originalText = elemento.textContent;
                elemento.textContent = 'Copiado!';
                elemento.style.background = '#d4edda';
                
                setTimeout(() => {
                    elemento.textContent = originalText;
                    elemento.style.background = '#f8f9fa';
                }, 1500);
                
            } catch (err) {
                console.error('Erro ao copiar:', err);
                alert('Erro ao copiar. Selecione e copie manualmente.');
            }
        }
    </script>
</body>
</html>